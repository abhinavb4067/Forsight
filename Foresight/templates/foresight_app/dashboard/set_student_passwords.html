{% extends 'foresight_app/dashboard/base.html' %}
{% block content %}

<div class="pt-24 md:ml-64 p-4 space-y-10">
  <section class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold text-center mb-6">üîê Set Student Passwords</h2>

    <!-- Batch Selection -->
    <form method="GET" class="mb-6">
      <label class="block font-semibold mb-2">Select Batch</label>
      <select name="batch" onchange="this.form.submit()" class="w-full border rounded px-4 py-2">
        <option value="" disabled {% if not selected_batch %}selected{% endif %}>Choose a batch</option>
        {% for batch in batches %}
          <option value="{{ batch }}" {% if selected_batch == batch %}selected{% endif %}>{{ batch }}</option>
        {% endfor %}
      </select>
    </form>

    {% if students %}
    <!-- Set all password input -->
    <div class="mb-4">
      <label class="font-semibold">Set same password for all</label>
      <input type="text" id="globalPassword" class="w-full border rounded px-4 py-2 mt-2" placeholder="Type here..." oninput="setAllPasswords(this.value)">
    </div>

    <!-- Student Password Table -->
    <form method="POST">
      {% csrf_token %}
      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-300">
          <thead class="bg-gray-100 text-left">
            <tr>
              <th class="border px-4 py-2">Student Name</th>
              <th class="border px-4 py-2">Email</th>
              <th class="border px-4 py-2">Password</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
            <tr>
              <td class="border px-4 py-2">{{ student.full_name }}</td>
              <td class="border px-4 py-2">{{ student.email }}</td>
              <td class="border px-4 py-2">
                <input type="text" name="password_{{ student.id }}" class="password-input w-full border rounded px-3 py-1" placeholder="Enter password">
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Submit Button -->
      <div class="mt-6 text-right">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">Save Passwords</button>
      </div>
    </form>
    {% else %}
      {% if selected_batch %}
        <p class="text-center text-gray-500 mt-4">No students found in selected batch.</p>
      {% endif %}
    {% endif %}
  </section>
</div>

<script>
  function setAllPasswords(value) {
    document.querySelectorAll('.password-input').forEach(input => input.value = value);
  }
</script>

{% endblock %}
