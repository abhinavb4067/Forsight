{% extends 'foresight_app/dashboard/base.html' %}
{% block content %}
<div class="pt-24 md:ml-64 p-4 space-y-10">
  <section class="bg-white p-6 rounded-lg shadow-md">
    <div class="table-container">
      <h2 class="text-2xl font-semibold mb-4 text-center">Class Management</h2>

      <!-- Add Class Button -->
      <button class="bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded mb-4" onclick="openModal('classAddModal')">âž• Add New Class</button>

      <!-- Table -->
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left border border-gray-300">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="border px-4 py-2">Class Name</th>
              <th class="border px-4 py-2 w-32">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if class_list %}
            {% for class in class_list %}
            <tr class="hover:bg-gray-50">
<td class="border px-4 py-2 whitespace-normal break-words">
  {{ class.name }}
</td>


              <td class="border px-4 py-2">
                <div class="flex gap-2">
                  <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs" onclick="openModal('classEditModal{{ class.id }}')">Edit</button>
                  <a href="{% url 'delete_class' class.id %}" onclick="return confirm('Are you sure you want to delete this class?')">
                    <button class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs">Delete</button>
                  </a>
                </div>
              </td>
            </tr>

            <!-- Edit Class Modal -->
            <div id="classEditModal{{ class.id }}" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden justify-center items-center">
              <div class="bg-white rounded-lg p-6 w-[90%] max-w-md relative">
                <span class="absolute top-2 right-4 text-xl font-bold text-gray-600 cursor-pointer" onclick="closeModal('classEditModal{{ class.id }}')">&times;</span>
                <form action="{% url 'edit_class' class.id %}" method="POST">
                  {% csrf_token %}
                  <h5 class="text-lg font-semibold mb-4">Edit Class</h5>
                  <input type="text" name="name" value="{{ class.name }}" class="w-full p-3 border border-gray-300 rounded mb-4" required />
                  <div class="text-right">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Update</button>
                  </div>
                </form>
              </div>
            </div>
            {% endfor %}
            {% else %}
            <tr>
              <td colspan="2" class="text-center py-4 font-semibold text-gray-500">No classes available. Please add a new class.</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </section>
</div>

<!-- Add Class Modal -->
<div id="classAddModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden justify-center items-center">
  <div class="bg-white rounded-lg p-6 w-[90%] max-w-md relative">
    <span class="absolute top-2 right-4 text-xl font-bold text-gray-600 cursor-pointer" onclick="closeModal('classAddModal')">&times;</span>
    <form action="{% url 'add_class' %}" method="POST">
      {% csrf_token %}
      <h5 class="text-lg font-semibold mb-4">Add New Class</h5>
      <input type="text" name="name" placeholder="Enter class name" class="w-full p-3 border border-gray-300 rounded mb-4" required />
      <div class="text-right">
        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Add</button>
      </div>
    </form>
  </div>
</div>

<!-- Scripts -->
<script>
  function openModal(id) {
    const modal = document.getElementById(id);
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }

  function closeModal(id) {
    const modal = document.getElementById(id);
    modal.classList.remove("flex");
    modal.classList.add("hidden");
  }

  window.onclick = function (event) {
    const modals = document.querySelectorAll('[id^="classEditModal"], #classAddModal');
    modals.forEach(modal => {
      if (event.target === modal) {
        modal.classList.remove("flex");
        modal.classList.add("hidden");
      }
    });
  };
</script>
{% endblock %}
