{% extends 'foresight_app/dashboard/base.html' %}
{% block content %}
<div class="pt-24 md:ml-64 p-4 space-y-10">
  <h2 class="text-2xl font-bold mb-6 text-center">
    Attendance for {{ selected_class.name }}
  </h2>

  <!-- Date Filter Form -->
  <form method="get" class="flex flex-col md:flex-row md:items-end gap-4 mb-6">
    <div>
      <label class="font-semibold block mb-1">From Date</label>
      <input type="date" name="from_date" value="{{ from_date }}" class="border px-3 py-2 rounded" />
    </div>
    <div>
      <label class="font-semibold block mb-1">To Date</label>
      <input type="date" name="to_date" value="{{ to_date }}" class="border px-3 py-2 rounded" />
    </div>
    <div>
      <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 mt-6 md:mt-0">
        Filter
      </button>
    </div>
  </form>

  <!-- Attendance Table -->
  <div class="overflow-auto bg-white rounded shadow">
    <table class="min-w-full text-sm border border-gray-300">
      <thead class="bg-gray-100">
        <tr>
          <th class="border px-4 py-2">Student Name</th>
          {% for date in dates %}
            <th class="border px-2 py-1" colspan="4">{{ date }}</th>
          {% endfor %}
        </tr>
        <tr>
          <th></th>
          {% for date in dates %}
            <th class="border px-2 py-1">P1</th>
            <th class="border px-2 py-1">P2</th>
            <th class="border px-2 py-1">P3</th>
            <th class="border px-2 py-1">P4</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for record in attendance_records %}
          <tr>
            <td class="border px-4 py-2 font-medium">{{ record.student.full_name }}</td>
            {% for att in record.records %}
              {% if att %}
                <td class="border text-center">{% if att.perid_1 %}✅{% else %}❌{% endif %}</td>
                <td class="border text-center">{% if att.perid_2 %}✅{% else %}❌{% endif %}</td>
                <td class="border text-center">{% if att.perid_3 %}✅{% else %}❌{% endif %}</td>
                <td class="border text-center">{% if att.perid_4 %}✅{% else %}❌{% endif %}</td>
              {% else %}
                <td class="border text-center" colspan="4">-</td>
              {% endif %}
            {% endfor %}
          </tr>
        {% empty %}
          <tr>
            <td colspan="{{ dates|length|add:'1' }}" class="text-center text-gray-500 py-4">No students found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
