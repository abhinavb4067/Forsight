{% extends 'foresight_app/dashboard/base.html' %}
{% block content %}
<div class="pt-24 md:ml-64 p-4 space-y-10">
  <section class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4 text-center">Manage Admissions</h2>

    <!-- Filter Form -->
    <form method="get" id="filterForm" class="flex flex-col md:flex-row gap-4 mb-6">
      <div class="flex flex-col w-full md:flex-row md:flex-1 gap-2">
        <label class="self-center">Course</label>
        <select name="course" class="w-full border rounded px-3 py-2" onchange="document.getElementById('filterForm').submit()">
          <option value="">All Courses</option>
          {% for course_name in courses %}
          <option value="{{ course_name }}" {% if course_name == selected_course %}selected{% endif %}>{{ course_name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="flex flex-col w-full md:flex-row md:flex-1 gap-2">
<label for="student-from" class="self-center">From Date</label>
        <input type="date" name="from_date" value="{{ from_date }}" class="input-field w-full md:flex-1" onchange="document.getElementById('filterForm').submit()">
      </div>

      <div class="flex flex-col w-full md:flex-row md:flex-1 gap-2">
<label for="student-to" class="self-center">To Date</label>
        <input type="date" name="to_date" value="{{ to_date }}" class="input-field w-full md:flex-1" onchange="document.getElementById('filterForm').submit()">
      </div>

      <div class="flex items-end">
        <button type="button" onclick="resetFilters()" class="w-full md:min-w-[120px] bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded">
          Reset
        </button>
      </div>
    </form>
<style>.input-field {
  padding: 0.5rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  width: 100%;         /* Ensures full width on mobile */
  min-width: 0;        /* Fixes flexbox shrink issues */
}
</style>
    <!-- Admissions Table Form -->
    <form method="POST">
      {% csrf_token %}
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left border border-gray-300">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="border px-4 py-2">Name</th>
              <th class="border px-4 py-2">Email</th>
              <th class="border px-4 py-2">Course</th>
              <th class="border px-4 py-2 text-center">Admitted</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
            <tr class="hover:bg-gray-50">
              <td class="border px-4 py-2">{{ student.full_name }}</td>
              <td class="border px-4 py-2">{{ student.email }}</td>
              <td class="border px-4 py-2">{{ student.course }}</td>
              <td class="border px-4 py-2 text-center">
                <input type="checkbox" name="admitted_ids" value="{{ student.id }}"
                       {% if student.id in admitted_ids %}checked{% endif %} />
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="text-right mt-6">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">
          Save Admissions
        </button>
      </div>
    </form>
  </section>
</div>

<!-- Reset Filter Script -->
<script>
  function resetFilters() {
    const form = document.getElementById('filterForm');
    form.course.value = '';
    form.from_date.value = '';
    form.to_date.value = '';
    form.submit();
  }
</script>
{% endblock %}
